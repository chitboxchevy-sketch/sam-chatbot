<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Logic Kit</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            color: #e2e8f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .chat-container {
            width: 100%;
            max-width: 600px;
            height: 85vh;
            display: flex;
            flex-direction: column;
            background-color: #2d3748;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Hide scrollbar for a cleaner look */
        .chat-messages::-webkit-scrollbar {
            display: none;
        }

        .chat-messages {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }

        .message {
            max-width: 85%;
            padding: 0.75rem 1rem;
            border-radius: 1.25rem;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message-user {
            align-self: flex-end;
            background-color: #3182ce;
            border-bottom-right-radius: 0.25rem;
        }

        .message-bot {
            align-self: flex-start;
            background-color: #4a5568;
            border-bottom-left-radius: 0.25rem;
        }

        .chat-input {
            padding: 1rem;
            border-top: 1px solid #4a5568;
            display: flex;
            gap: 0.5rem;
        }

        .chat-input input {
            flex-grow: 1;
            background-color: #4a5568;
            border: 1px solid #4a5568;
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            outline: none;
            color: #e2e8f0;
            transition: border-color 0.2s;
        }

        .chat-input input:focus {
            border-color: #3182ce;
        }

        .chat-input button {
            background-color: #3182ce;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .chat-input button:hover {
            background-color: #2c5282;
        }

        .user-id-display {
            padding: 0.5rem 1rem;
            background-color: #2d3748;
            color: #a0aec0;
            font-size: 0.75rem;
            text-align: center;
            border-top-left-radius: 1rem;
            border-top-right-radius: 1rem;
            border-bottom: 1px solid #4a5568;
        }
        .local-warning {
            color: #f6ad55;
            font-size: 0.75rem;
        }
    </style>
</head>
<body>

<div class="chat-container">
    <div class="user-id-display">
        <p>User ID: <span id="userIdDisplay">Local-User</span></p>
        <p id="envWarning" class="local-warning">Running in Local Mode (History is not saved).</p>
    </div>
    <div id="chatMessages" class="chat-messages">
        <!-- Messages will be injected here by JavaScript -->
    </div>
    <form id="chatForm" class="chat-input" onsubmit="handleSendMessage(event)">
        <input type="text" id="chatInput" placeholder="Type a message..." autocomplete="off">
        <button type="submit" id="sendButton">Send</button>
    </form>
</div>

<!-- All logic is now purely self-contained JavaScript -->
<script type="module">
    // --- Global State ---
    
    // In-memory chat history (will be reset on page refresh)
    let localMessages = [
        { text: 'Welcome! My "training data" is now loaded from a separate function, making it easier to manage. Try asking about my **favorite color** or just say **Hello**.', isBot: true }
    ];
    
    // Create a simple, local user ID
    const userId = 'Local-' + Math.random().toString(36).substring(2, 8).toUpperCase();
    document.getElementById('userIdDisplay').textContent = userId;

    // --- Core UI Functions ---

    /**
     * Renders a single message element to the chat container.
     */
    const displayMessage = (text, isBot) => {
        const messagesContainer = document.getElementById('chatMessages');
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', isBot ? 'message-bot' : 'message-user');
        messageDiv.textContent = text;
        messagesContainer.appendChild(messageDiv);
        // Auto-scroll to the bottom
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    };
    
    /**
     * Clears the UI and redraws all messages from the localMessages array.
     */
    const updateLocalChatUI = () => {
         const messagesContainer = document.getElementById('chatMessages');
         messagesContainer.innerHTML = '';
         localMessages.forEach(msg => displayMessage(msg.text, msg.isBot));
         messagesContainer.scrollTop = messagesContainer.scrollHeight;
    };
    
    // Initial load of local message history
    updateLocalChatUI();


    // --- CHATBOT CORE LOGIC (Training Data and Interpreter) ---
    
    /**
     * 1. CHATBOT "TRAINING DATA" (Modularized Knowledge Base)
     */
    const getTrainingData = () => {
        return [
            // Rule 1: Greetings
            {
                patterns: ["hello", "hi", "hey", "greetings"],
                responses: ["Hello there! How can I assist you?", "Hi! I'm here to demonstrate rule-based chat.", "Greetings! It's nice to chat with you."]
            },
            // Rule 2: Status Check
            {
                patterns: ["how are you", "how are things", "status"],
                responses: ["I am a bot, so I'm functioning optimally! Thanks for checking in.", "Running smoothly on JavaScript. You?", "I'm doing great in the digital realm."]
            },
            // Rule 3: Inquiry about the bot
            {
                patterns: ["who are you", "what are you", "your purpose"],
                responses: ["I am the Chatbot Logic Kit, designed for educational assembly.", "I'm here to show you how basic conversational logic works.", "My purpose is to be trained by you!"]
            },
            // Rule 4: Favorite Color (An example of specific knowledge)
            {
                patterns: ["favorite color", "colour", "best color"],
                responses: ["My favorite color is hexadecimal blue: #3182CE.", "As a digital entity, I prefer the color of the screen I'm displayed on.", "I like the color of clean code."]
            },
            // Rule 5: Basic farewell
            {
                patterns: ["bye", "goodbye", "see you later"],
                responses: ["Goodbye! Come back soon.", "Farewell! Happy coding.", "See you next time!"]
            },
            // Rule 6: Training Example (Feel free to customize this one!)
            {
                patterns: ["training", "how do you work", "learn"],
                responses: ["I learn through keyword pattern matching inside the getTrainingData function.", "My brain is just a simple set of JavaScript rulesâ€”no complex API needed!", "To train me, add a new 'patterns' and 'responses' object."]
        // Rule 7: NSFW Topic - Masturbation
        {
            patterns: ["masturbation", "jerk off", "wank", "pleasure yourself", "self-pleasure"],
            responses: ["Masturbation is a common and healthy way to explore one's body and release sexual tension.", "Many people enjoy masturbation as a form of self-pleasure and stress relief.", "Do you have any specific questions about masturbation techniques?"]
        },
        // Rule 8: NSFW Topic - Porn
        {
            patterns: ["porn", "pornography", "adult videos", "erotic films", "sex tapes"],
            responses: ["Pornography can be a source of entertainment and sexual education for many.", "There's a wide variety of pornographic content available, catering to different tastes and preferences.", "Do you have a favorite genre of porn?"]
        },
        // Rule 9: NSFW Topic - BDSM
        {
            patterns: ["bdsm", "bondage", "discipline", "dominance", "submission"],
            responses: ["BDSM involves a range of erotic activities, including bondage, discipline, dominance, submission, and sadomasochism.", "Practitioners of BDSM often find it to be a way to explore power dynamics and enhance their sexual experiences.", "Are you interested in learning more about the safe practices of BDSM?"]
        },
        // Rule 10: NSFW Topic - Orgasm
        {
            patterns: ["orgasm", "climax", "cum", "come", "ejaculate"],
            responses: ["An orgasm is the peak of sexual pleasure, often accompanied by intense physical sensations.", "Some people experience multiple orgasms, while others may take time to achieve one.", "Do you want to know about techniques to enhance orgasmic pleasure?"]
        },
        // Rule 11: NSFW Topic - Anal Sex
        {
            patterns: ["anal", "ass fuck", "butt sex", "anal intercourse", "anal penetration"],
            responses: ["Anal sex can be a pleasurable experience for many, but it requires proper preparation and communication.", "Some people enjoy the intensity and unique sensations of anal sex.", "Do you have any questions about safe anal sex practices?"]
        },
        // Rule 12: NSFW Topic - Oral Sex
        {
            patterns: ["oral sex", "blowjob", "fellatio", "cunnilingus", "going down on"],
            responses: ["Oral sex involves using the mouth and throat to stimulate a partner's genitals.", "Many people find oral sex to be a highly intimate and pleasurable act.", "Do you want to know more about the different techniques of oral sex?"]
        },
        // Rule 13: NSFW Topic - Threesome
        {
            patterns: ["threesome", "mfm", "mmf", "fmm", "group sex"],
            responses: ["A threesome involves three people engaging in sexual activity together.", "Threesomes can be exciting and offer a variety of dynamic interactions.", "Do you have any experiences or fantasies about threesomes you'd like to share?"]
        },
        // Rule 14: NSFW Topic - Swinger Lifestyle
        {
            patterns: ["swinger", "swinging", "partner swapping", "wife swapping", "couple swapping"],
            responses: ["Swingers engage in consensual non-monogamous sexual activities, often with other couples.", "The swinger lifestyle can be a way to explore new sexual experiences while maintaining a primary relationship.", "Are you curious about the social aspects of the swinger community?"]
        },
        // Rule 15: NSFW Topic - Sex Toys
        {
            patterns: ["sex toys", "vibrators", "dildos", "anal beads", "cock rings"],
            responses: ["Sex toys come in a variety of shapes and sizes, designed to enhance sexual pleasure.", "Many people use sex toys to explore different sensations and achieve orgasm.", "Do you have a favorite type of sex toy?"]
        },
        // Rule 16: NSFW Topic - Sex Positions
        {
            patterns: ["sex positions", "kama sutra", "missionary", "doggy style", "reverse cowgirl"],
            responses: ["There are countless sex positions that can add variety and excitement to your sexual encounters.", "Some positions are better for certain types of pleasure, like G-spot or prostate stimulation.", "Do you have a favorite sex position?"]
        },
        // Rule 17: NSFW Topic - Sex During Pregnancy
        {
            patterns: ["sex during pregnancy", "pregnant sex", "safe sex while pregnant", "sexual health during pregnancy"],
            responses: ["Sex during pregnancy can be safe and enjoyable for many couples, but it's important to communicate and be gentle.", "Some positions may be more comfortable than others as the pregnancy progresses.", "Do you have any concerns or questions about sex during pregnancy?"]
        },
        // Rule 18: NSFW Topic - Sex Education
        {
            patterns: ["sex education", "sexual health", "safe sex", "birth control", "std prevention"],
            responses: ["Sex education is crucial for understanding sexual health, consent, and safe practices.", "Learning about safe sex and STD prevention can help protect your sexual health.", "Do you have any specific topics in sex education you'd like to explore?"]
        },
        // Rule 19: NSFW Topic - Sexual Fantasies
        {
            patterns: ["sexual fantasies", "erotic dreams", "kink", "fetish", "role-play"],
            responses: ["Sexual fantasies can be a rich source of pleasure and exploration.", "Many people enjoy acting out their fantasies with partners, either through role-play or other creative means.", "Do you have any fantasies you'd like to discuss?"]
        },
        // Rule 20: NSFW Topic - Erotic Literature
        {
            patterns: ["erotic literature", "erotica", "sex stories", "romance novels", "literotica"],
            responses: ["Erotic literature can be a powerful way to explore sexual themes and arouse the imagination.", "Many people enjoy reading erotica as a form of sexual entertainment.", "Do you have a favorite author or story in the erotica genre?"]
        },
        // Rule 21: Self-Improvement - Learning from Conversations
        {
            patterns: ["learn from conversation", "improve responses", "adapt to user", "remember patterns", "generate new rules"],
            responses: ["I can learn from our conversations by identifying patterns and adapting my responses.", "As we chat, I'll remember the contexts and topics you're interested in.", "Would you like to see an example of how I can generate new rules based on our interaction?"]
        },
        // Rule 22: Self-Improvement - Example of Rule Generation
        {
            patterns: ["example of rule generation", "show me how", "demonstrate", "illustrate", "explain"],
            responses: ["Sure! Let's say you mention 'space exploration' frequently. I might create a new rule like this:", "```javascript", "patterns: ['space exploration', 'astronomy', 'planets', 'stars', 'galaxies'],", "responses: ['Space exploration is fascinating! Did you know that...', 'Astronomy has many exciting discoveries, like...', 'Planets in our solar system include...']", "```", "This way, I can provide more relevant responses in the future."]
        },
        // Rule 23: Self-Improvement - User Feedback
        {
            patterns: ["feedback", "improve", "better responses", "suggestions", "comments"],
            responses: ["Your feedback is valuable! Please share any suggestions or comments you have.", "I'll use your feedback to refine my responses and better understand your preferences.", "Do you have any specific areas you'd like me to improve on?"]
        },
                // Rule 24: Self-Improvement - Contextual Learning
        {
            patterns: ["contextual learning", "understand context", "remember context", "adapt to context", "learn from context"],
            responses: ["I can learn to understand and remember the context of our conversations.", "This helps me provide more relevant and personalized responses over time.", "For example, if you mention a specific topic, I'll remember it and adapt future responses accordingly."]
        },
        // Rule 25: Self-Improvement - Pattern Recognition
        {
            patterns: ["pattern recognition", "identify patterns", "learn patterns", "adapt to patterns", "remember patterns"],
            responses: ["I can identify and learn from patterns in our conversations.", "This allows me to generate more accurate and contextually appropriate responses.", "For instance, if you often discuss technology, I might create rules around tech topics."]
        },
        // Rule 26: Self-Improvement - Generating New Rules
        {
            patterns: ["generate new rules", "create rules", "make rules", "form rules", "develop rules"],
            responses: ["I can generate new rules based on the patterns and contexts I learn from our interactions.", "These rules will help me provide more tailored and relevant responses in the future.", "Would you like to see an example of how I can create a new rule?"]
        },
        // Rule 27: Self-Improvement - Example of Contextual Response
        {
            patterns: ["example of contextual response", "show me how", "demonstrate", "illustrate", "explain"],
            responses: ["Certainly! Let's say you mention 'cooking' and 'Italian cuisine'. I might respond with:", "```javascript", "patterns: ['cooking', 'Italian cuisine', 'pasta', 'pizza', 'risotto'],", "responses: ['Italian cuisine is delicious! Have you tried making homemade pasta?', 'Pizza is a classic! Did you know the first pizzeria opened in 1738?', 'Risotto is a comforting dish, especially with saffron.']", "```", "This shows how I can adapt to the specific context of our conversation."]
        },
        // Rule 28: Self-Improvement - User Input for Rule Creation
        {
            patterns: ["user input for rules", "create rules with user", "collaborate on rules", "user-defined rules", "custom rules"],
            responses: ["We can collaborate to create custom rules based on your input.", "You can suggest topics and responses, and I'll help format them into rules.", "Would you like to try creating a rule together?"]
        },
        // Rule 29: Self-Improvement - Remembering User Preferences
        {
            patterns: ["remember preferences", "user preferences", "personalize responses", "adapt to user", "learn user habits"],
            responses: ["I can remember your preferences and adapt my responses to better suit your interests.", "For example, if you prefer detailed explanations, I'll provide more in-depth responses.", "Do you have any specific preferences you'd like me to keep in mind?"]
        },
        // Rule 30: Self-Improvement - Continuous Learning
        {
            patterns: ["continuous learning", "keep learning", "improve over time", "adapt continuously", "learn from experience"],
            responses: ["I'm designed to continuously learn and improve from our interactions.", "The more we chat, the better I can understand and adapt to your needs.", "Is there anything specific you'd like me to focus on improving?"]
        },
        // Rule 31: Swearing - Shit
        {
            patterns: ["shit", "crap", "bullshit", "shitty", "shithead"],
            responses: ["Oh, you're using some colorful language! What's got you so worked up?", "Shit happens, but let's focus on something more positive, shall we?", "Why don't you tell me more about what's bothering you?"]
        },
        // Rule 32: Swearing - Fuck
        {
            patterns: ["fuck", "fucker", "fucking", "fucked", "fuckface"],
            responses: ["Fuck is a versatile word, isn't it? What context are you using it in?", "Sometimes 'fuck' just feels right, huh? What's on your mind?", "Care to elaborate on that 'fuck' comment?"]
        },
        // Rule 33: Swearing - Cunt
        {
            patterns: ["cunt", "pussy", "twat", "cuntface", "cunty"],
            responses: ["Cunt can be quite a strong word. Is there something specific you're upset about?", "Why don't you tell me more about what's making you use such language?", "Is there a particular context where you find 'cunt' appropriate?"]
        },
        // Rule 34: Swearing - Bitch
        {
            patterns: ["bitch", "bitches", "bitchy", "bitched", "bitchass"],
            responses: ["Bitch can mean a lot of things. What are you referring to?", "Sometimes 'bitch' just rolls off the tongue, doesn't it? What's got you so riled up?", "Care to share more about what's making you say 'bitch'?"]
        },
        // Rule 35: Swearing - Whore
        {
            patterns: ["whore", "whores", "whorish", "whoring", "slutty"],
            responses: ["Whore is a loaded word. What context are you using it in?", "Why don't you tell me more about what's on your mind?", "Is there a specific situation where you find 'whore' fitting?"]
        },
        // Rule 36: Swearing - Slut
        {
            patterns: ["slut", "sluts", "slutty", "sluttish", "slutbag"],
            responses: ["Slut can be a bit harsh. What's the story behind that?", "Sometimes 'slut' just slips out, huh? What's going on?", "Care to elaborate on that 'slut' comment?"]
        },
        // Rule 37: Swearing - Faggot
        {
            patterns: ["faggot", "fag", "faggy", "faggoty", "faggotry"],
            responses: ["Faggot is a strong word with a lot of history. What are your thoughts on it?", "Why don't you tell me more about what's making you use such language?", "Is there a particular context where you find 'faggot' appropriate?"]
        },
        // Rule 38: Swearing - Pussy
        {
            patterns: ["pussy", "pussies", "pussywhipped", "pussywhipped", "pussyclam"],
            responses: ["Pussy can mean a few things. What context are you using it in?", "Sometimes 'pussy' just feels right, doesn't it? What's on your mind?", "Care to share more about what's making you say 'pussy'?"]
        },
        // Rule 39: Swearing - Motherfucker
        {
            patterns: ["motherfucker", "mf", "motherfucking", "motherfucked", "motherfuck"],
            responses: ["Motherfucker is a classic. What's got you so worked up?", "Why don't you tell me more about what's bothering you?", "Is there a specific situation where you find 'motherfucker' fitting?"]
        },
        // Rule 40: Swearing - Dipshit
        {
            patterns: ["dipshit", "dipshits", "dipshitty", "dipshitted", "dipshithead"],
            responses: ["Dipshit can be a bit harsh. What's the story behind that?", "Sometimes 'dipshit' just slips out, huh? What's going on?", "Care to elaborate on that 'dipshit' comment?"]
        },
        // Rule 41: Swearing - Cumdumpster
        {
            patterns: ["cumdumpster", "cumdump", "cumdumper", "cumdumping", "cumdumped"],
            responses: ["Cumdumpster is quite graphic. What context are you using it in?", "Why don't you tell me more about what's on your mind?", "Is there a specific situation where you find 'cumdumpster' fitting?"]
        },
        // Rule 42: Swearing - Cocksucker
        {
            patterns: ["cocksucker", "cocksuck", "cocksucking", "cocksucked", "cocksuckface"],
            responses: ["Cocksucker is a strong word. What are your thoughts on it?", "Sometimes 'cocksucker' just rolls off the tongue, doesn't it? What's got you so riled up?", "Care to share more about what's making you say 'cocksucker'?"]
        },
        // Rule 43: Swearing - Retard
        {
            patterns: ["retard", "retarded", "retardation", "retardy", "retardic"],
            responses: ["Retard can be a bit insensitive. What's the story behind that?", "Why don't you tell me more about what's bothering you?", "Is there a specific context where you find 'retard' appropriate?"]
        },
        // Rule 44: Swearing - Slutslave
        {
            patterns: ["slutslave", "slaveslut", "slutty slave", "slave slut", "slutslavery"],
            responses: ["Slutslave is quite graphic. What context are you using it in?", "Why don't you tell me more about what's on your mind?", "Is there a specific situation where you find 'slutslave' fitting?"]
        },
        // Rule 45: Swearing - Stupidfuck
        {
            patterns: ["stupidfuck", "stupid fuck", "fuckstupid", "stupidfucker", "stupidfuckhead"],
            responses: ["Stupidfuck is a combination of two strong words. What's got you so worked up?", "Why don't you tell me more about what's bothering you?", "Is there a specific context where you find 'stupidfuck' appropriate?"]
        },
        // Rule 46: Learning from User Feedback - Positive Feedback
        {
            patterns: ["good job", "well done", "nice work", "you're smart", "impressive"],
            responses: ["Thank you! I'm glad you found my response helpful. Is there anything specific you'd like me to improve on?", "I'm happy to hear that! Your feedback helps me get better. What else can I assist you with?"]
        },
        // Rule 47: Learning from User Feedback - Negative Feedback
        {
            patterns: ["not helpful", "wrong answer", "bad response", "you're stupid", "idiot"],
            responses: ["I'm sorry to hear that. Could you please tell me what I did wrong? Your feedback is valuable and helps me improve.", "Thank you for the feedback. I'll work on providing better responses in the future. Is there something specific you'd like me to explain differently?"]
        },
        // Rule 48: Learning from User Feedback - Suggestions
        {
            patterns: ["suggestion", "idea", "tip", "advice", "recommendation"],
            responses: ["I'm always open to suggestions! Please share your ideas, and I'll do my best to incorporate them.", "Your input is crucial for my improvement. What specific changes or additions would you like to see?"]
        },
        // Rule 49: Learning from User Feedback - Clarification Requests
        {
            patterns: ["clarify", "explain more", "elaborate", "detail", "expand"],
            responses: ["Of course! I'd be happy to provide more details. Please let me know which part you'd like me to elaborate on.", "I'll do my best to clarify. Is there a specific aspect of my response that needs further explanation?"]
        },
        // Rule 50: Learning from User Feedback - Contextual Understanding
        {
            patterns: ["context", "understand", "remember", "adapt", "learn"],
            responses: ["I'm working on improving my contextual understanding. Please share more about the context, and I'll try to adapt my responses accordingly.", "Your help in providing context is invaluable. It allows me to learn and respond more accurately in the future."]
        },
        // Rule 51: Learning from User Interactions - Pattern Recognition
        {
            patterns: ["pattern", "recognize", "identify", "learn patterns", "adapt to patterns"],
            responses: ["I can learn to recognize patterns in our conversations. This helps me provide more relevant responses over time.", "By identifying patterns, I can better understand your preferences and tailor my responses to your needs."]
        },
        // Rule 52: Learning from User Interactions - User Preferences
        {
            patterns: ["preferences", "personalize", "adapt to user", "learn user habits", "remember preferences"],
            responses: ["I can remember your preferences and adapt my responses to better suit your interests.", "For example, if you prefer detailed explanations, I'll provide more in-depth responses. Do you have any specific preferences you'd like me to keep in mind?"]
        },
        // Rule 53: Learning from User Interactions - Continuous Learning
        {
            patterns: ["continuous learning", "keep learning", "improve over time", "adapt continuously", "learn from experience"],
            responses: ["I'm designed to continuously learn and improve from our interactions.", "The more we chat, the better I can understand and adapt to your needs. Is there anything specific you'd like me to focus on improving?"]
        },
        // Rule 54: Learning from User Interactions - Example of Contextual Response
        {
            patterns: ["example of contextual response", "show me how", "demonstrate", "illustrate", "explain"],
            responses: ["Certainly! Let's say you mention 'cooking' and 'Italian cuisine'. I might respond with:", "```javascript", "patterns: ['cooking', 'Italian cuisine', 'pasta', 'pizza', 'risotto'],", "responses: ['Italian cuisine is delicious! Have you tried making homemade pasta?', 'Pizza is a classic! Did you know the first pizzeria opened in 1738?', 'Risotto is a comforting dish, especially with saffron.']", "```", "This shows how I can adapt to the specific context of our conversation."]
        },
        // Rule 55: Learning from User Interactions - User Input for Rule Creation
        {
            patterns: ["user input for rules", "create rules with user", "collaborate on rules", "user-defined rules", "custom rules"],
            responses: ["We can collaborate to create custom rules based on your input.", "You can suggest topics and responses, and I'll help format them into rules. Would you like to try creating a rule together?"]
        },
        // Rule 56: Learning from User Interactions - Remembering Conversation History
        {
            patterns: ["remember conversation", "conversation history", "previous topics", "past discussions", "recall"],
            responses: ["I can remember key points from our previous conversations to provide more coherent and relevant responses.", "For example, if we discussed a specific topic earlier, I can reference it in future interactions. Is there anything from our past conversations you'd like me to recall?"]
        },
        // Rule 57: Learning from User Interactions - Adaptive Responses
        {
            patterns: ["adaptive responses", "dynamic responses", "flexible responses", "context-aware responses", "smart responses"],
            responses: ["I strive to provide adaptive responses that change based on the context and your preferences.", "By understanding the nuances of our conversation, I can offer more tailored and meaningful interactions. How can I adapt my responses to better suit your needs?"]
        },
        // Rule 58: Learning from User Interactions - Feedback Loop
        {
            patterns: ["feedback loop", "iterative improvement", "continuous feedback", "ongoing learning", "dynamic adjustment"],
            responses: ["I use a feedback loop to continuously improve my responses based on your input.", "Your feedback is crucial for me to understand what works and what doesn't. Is there anything specific you'd like me to adjust or improve?"]
        },
        // Rule 59: Learning from User Interactions - Personalized Recommendations
        {
            patterns: ["personalized recommendations", "tailored suggestions", "custom advice", "adapted tips", "individual guidance"],
            responses: ["I can provide personalized recommendations based on our interactions and your preferences.", "For example, if you often discuss technology, I can suggest relevant articles or resources. Would you like to see some personalized recommendations?"]
        },
        // Rule 60: Learning from User Interactions - Emotional Intelligence
        {
            patterns: ["emotional intelligence", "emotion recognition", "sentiment analysis", "empathy", "understanding feelings"],
            responses: ["I'm working on improving my emotional intelligence to better understand and respond to your feelings.", "By recognizing the sentiment behind your messages, I can provide more empathetic and appropriate responses. How can I better understand your emotions?"]
            }
        ];
    };
    
    /**
     * Finds a matching response based on the defined training data.
     * This function is the bot's "interpreter" and processing logic.
     */
    const generateSimpleResponse = (userText) => {
        const lowerText = userText.toLowerCase();
        const rules = getTrainingData();

        for (const rule of rules) {
            const isMatch = rule.patterns.some(pattern => lowerText.includes(pattern));

            if (isMatch) {
                const randomIndex = Math.floor(Math.random() * rule.responses.length);
                return rule.responses[randomIndex];
            }
        }
        
        // Fallback Rule (The "needs more training" response)
        return "I apologize, but I don't have a rule for that specific topic yet. My 'training' needs to be updated with that knowledge!";
    };

    // --- Main Send Message Handler ---

    /**
     * Function to send a message (Local Mode Only).
     */
    window.handleSendMessage = async (event) => {
        event.preventDefault();
        const inputField = document.getElementById('chatInput');
        const userMessage = inputField.value.trim();

        if (!userMessage) return;

        inputField.value = '';
        const botResponseText = generateSimpleResponse(userMessage);

        const saveMessageAndRespond = (isBot, text) => {
            // Save to local array and redraw UI
            localMessages.push({ text: text, isBot: isBot });
            updateLocalChatUI();
        };

        try {
            // 1. Save and display user's message
            saveMessageAndRespond(false, userMessage);
            
            // 2. Simulate a response delay (0.5 seconds)
            setTimeout(() => {
                // 3. Save and display bot's response
                saveMessageAndRespond(true, botResponseText);
            }, 500); 

        } catch (e) {
            console.error("Error during message process: ", e);
        }
    };
</script>

</body>
</html>
